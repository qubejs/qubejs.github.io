!function(){"use strict";const e=e=>{let t=e;return{get:()=>t,set:e=>{t=e}}};var t=tinymce.util.Tools.resolve("tinymce.PluginManager");const n=e=>t=>(e=>{const t=typeof e;return null===e?"null":"object"===t&&Array.isArray(e)?"array":"object"===t&&(n=r=e,o=(s=String).prototype,o.isPrototypeOf(n)||(null===(a=r.constructor)||void 0===a?void 0:a.name)===s.name)?"string":t;var n,o;var r,s,a})(t)===e,o=e=>t=>typeof t===e,r=n("string"),s=n("array"),a=o("boolean"),l=o("number"),i=()=>{},c=e=>()=>e,d=c(!0),m=c("[!-#%-*,-\\/:;?@\\[-\\]_{}\xa1\xab\xb7\xbb\xbf;\xb7\u055a-\u055f\u0589\u058a\u05be\u05c0\u05c3\u05c6\u05f3\u05f4\u0609\u060a\u060c\u060d\u061b\u061e\u061f\u066a-\u066d\u06d4\u0700-\u070d\u07f7-\u07f9\u0830-\u083e\u085e\u0964\u0965\u0970\u0df4\u0e4f\u0e5a\u0e5b\u0f04-\u0f12\u0f3a-\u0f3d\u0f85\u0fd0-\u0fd4\u0fd9\u0fda\u104a-\u104f\u10fb\u1361-\u1368\u1400\u166d\u166e\u169b\u169c\u16eb-\u16ed\u1735\u1736\u17d4-\u17d6\u17d8-\u17da\u1800-\u180a\u1944\u1945\u1a1e\u1a1f\u1aa0-\u1aa6\u1aa8-\u1aad\u1b5a-\u1b60\u1bfc-\u1bff\u1c3b-\u1c3f\u1c7e\u1c7f\u1cd3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205e\u207d\u207e\u208d\u208e\u3008\u3009\u2768-\u2775\u27c5\u27c6\u27e6-\u27ef\u2983-\u2998\u29d8-\u29db\u29fc\u29fd\u2cf9-\u2cfc\u2cfe\u2cff\u2d70\u2e00-\u2e2e\u2e30\u2e31\u3001-\u3003\u3008-\u3011\u3014-\u301f\u3030\u303d\u30a0\u30fb\ua4fe\ua4ff\ua60d-\ua60f\ua673\ua67e\ua6f2-\ua6f7\ua874-\ua877\ua8ce\ua8cf\ua8f8-\ua8fa\ua92e\ua92f\ua95f\ua9c1-\ua9cd\ua9de\ua9df\uaa5c-\uaa5f\uaade\uaadf\uabeb\ufd3e\ufd3f\ufe10-\ufe19\ufe30-\ufe52\ufe54-\ufe61\ufe63\ufe68\ufe6a\ufe6b\uff01-\uff03\uff05-\uff0a\uff0c-\uff0f\uff1a\uff1b\uff1f\uff20\uff3b-\uff3d\uff3f\uff5b\uff5d\uff5f-\uff65]");class Optional{constructor(e,t){this.tag=e,this.value=t}static some(e){return new Optional(!0,e)}static none(){return Optional.singletonNone}fold(e,t){return this.tag?t(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(e){return this.tag?Optional.some(e(this.value)):Optional.none()}bind(e){return this.tag?e(this.value):Optional.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(e){return!this.tag||e(this.value)?this:Optional.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw new Error(null!=e?e:"Called getOrDie on None")}static from(e){return(e=>null==e)(e)?Optional.none():Optional.some(e)}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}Optional.singletonNone=new Optional(!1);const u=m;var h=tinymce.util.Tools.resolve("tinymce.Env"),g=tinymce.util.Tools.resolve("tinymce.util.Tools");const f=Array.prototype.slice,p=Array.prototype.push,x=(e,t)=>{const n=e.length,o=new Array(n);for(let r=0;r<n;r++){const n=e[r];o[r]=t(n,r)}return o},y=(e,t)=>{for(let n=0,o=e.length;n<o;n++){t(e[n],n)}},w=(e,t)=>{for(let n=e.length-1;n>=0;n--){t(e[n],n)}},v=(e,t)=>(e=>{const t=[];for(let n=0,o=e.length;n<o;++n){if(!s(e[n]))throw new Error("Arr.flatten item "+n+" was not an array, input: "+e);p.apply(t,e[n])}return t})(x(e,t)),b=Object.hasOwnProperty,O=(e,t)=>b.call(e,t);"undefined"!=typeof window?window:Function("return this;")();const C=(E=3,e=>(e=>e.dom.nodeType)(e)===E);var E;const N=(e,t,n)=>{((e,t,n)=>{if(!(r(n)||a(n)||l(n)))throw console.error("Invalid call to Attribute.set. Key ",t,":: Value ",n,":: Element ",e),new Error("Attribute value was not simple");e.setAttribute(t,n+"")})(e.dom,t,n)},T=e=>{if(null==e)throw new Error("Node cannot be null or undefined");return{dom:e}},k={fromHtml:(e,t)=>{const n=(t||document).createElement("div");if(n.innerHTML=e,!n.hasChildNodes()||n.childNodes.length>1){const t="HTML does not have a single root node";throw console.error(t,e),new Error(t)}return T(n.childNodes[0])},fromTag:(e,t)=>{const n=(t||document).createElement(e);return T(n)},fromText:(e,t)=>{const n=(t||document).createTextNode(e);return T(n)},fromDom:T,fromPoint:(e,t,n)=>Optional.from(e.dom.elementFromPoint(t,n)).map(T)},A=(e,t)=>({element:e,offset:t}),S=(e,t)=>{const n=(e=>x(e.dom.childNodes,k.fromDom))(e);return n.length>0&&t<n.length?A(n[t],0):A(e,t)},D=(e,t)=>{const n=(e=>Optional.from(e.dom.parentNode).map(k.fromDom))(e);n.each((n=>{n.dom.insertBefore(t.dom,e.dom)}))},M=(e,t)=>{D(e,t),((e,t)=>{e.dom.appendChild(t.dom)})(t,e)},B=((e,t)=>{const n=t=>e(t)?Optional.from(t.dom.nodeValue):Optional.none();return{get:o=>{if(!e(o))throw new Error("Can only get "+t+" value of a "+t+" node");return n(o).getOr("")},getOption:n,set:(n,o)=>{if(!e(n))throw new Error("Can only set raw "+t+" value of a "+t+" node");n.dom.nodeValue=o}}})(C,"text"),F=e=>B.get(e),I=(e,t)=>((e,t)=>{const n=void 0===t?document:t.dom;return 1!==(o=n).nodeType&&9!==o.nodeType&&11!==o.nodeType||0===o.childElementCount?[]:x(n.querySelectorAll(e),k.fromDom);var o})(t,e);var R=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker");const P=(e,t)=>e.isBlock(t)||O(e.schema.getVoidElements(),t.nodeName),W=(e,t)=>"false"===e.getContentEditable(t),$=(e,t)=>!e.isBlock(t)&&O(e.schema.getWhitespaceElements(),t.nodeName),V=(e,t)=>S(k.fromDom(e),t),j=(e,t,n,o,r,s=!0)=>{let a=s?t(!1):n;for(;a;){const n=W(e,a);if(n||$(e,a)){if(n?o.cef(a):o.boundary(a))break;a=t(!0)}else{if(P(e,a)){if(o.boundary(a))break}else 3===a.nodeType&&o.text(a);if(a===r)break;a=t(!1)}}},H=(e,t,n,o,r)=>{var s;if(((e,t)=>P(e,t)||W(e,t)||$(e,t)||((e,t)=>"true"===e.getContentEditable(t)&&t.parentNode&&"false"===e.getContentEditableParent(t.parentNode))(e,t))(e,n))return;const a=null!==(s=e.getParent(o,e.isBlock))&&void 0!==s?s:e.getRoot(),l=new R(n,a),i=r?l.next.bind(l):l.prev.bind(l);j(e,i,n,{boundary:d,cef:d,text:e=>{r?t.fOffset+=e.length:t.sOffset+=e.length,t.elements.push(k.fromDom(e))}})},_=(e,t,n,o,r,s=!0)=>{const a=new R(n,t),l=[];let i={sOffset:0,fOffset:0,elements:[]};H(e,i,n,t,!1);const c=()=>(i.elements.length>0&&(l.push(i),i={sOffset:0,fOffset:0,elements:[]}),!1);return j(e,a.next.bind(a),n,{boundary:c,cef:e=>(c(),r&&l.push(...r.cef(e)),!1),text:e=>{i.elements.push(k.fromDom(e)),r&&r.text(e,i)}},o,s),o&&H(e,i,o,t,!0),c(),l},z=(e,t)=>{const n=V(t.startContainer,t.startOffset),o=n.element.dom,r=V(t.endContainer,t.endOffset),s=r.element.dom;return _(e,t.commonAncestorContainer,o,s,{text:(e,t)=>{e===s?t.fOffset+=e.length-r.offset:e===o&&(t.sOffset+=n.offset)},cef:t=>((e,t)=>{const n=f.call(e,0);return n.sort(t),n})(v(I(k.fromDom(t),"*[contenteditable=true]"),(t=>{const n=t.dom;return _(e,n,n)})),((e,t)=>((e,t)=>((e,t,n)=>0!=(e.compareDocumentPosition(t)&n))(e,t,Node.DOCUMENT_POSITION_PRECEDING))(e.elements[0].dom,t.elements[0].dom)?1:-1))},!1)},L=(e,t)=>t.collapsed?[]:z(e,t),U=(e,t)=>{const n=e.createRng();return n.selectNode(t),L(e,n)},q=(e,t)=>{const n=(o=e,r=(e,n)=>{const o=F(n),r=e.last,s=r+o.length,a=v(t,((e,t)=>e.start<s&&e.finish>r?[{element:n,start:Math.max(r,e.start)-r,finish:Math.min(s,e.finish)-r,matchId:t}]:[]));return{results:e.results.concat(a),last:s}},s={results:[],last:0},y(o,((e,t)=>{s=r(s,e,t)})),s).results;var o,r,s;return((e,t)=>{if(0===e.length)return[];{let n=t(e[0]);const o=[];let r=[];for(let s=0,a=e.length;s<a;s++){const a=e[s],l=t(a);l!==n&&(o.push(r),r=[]),n=l,r.push(a)}return 0!==r.length&&o.push(r),o}})(n,(e=>e.matchId))},G=(e,t)=>v(t,(t=>{const n=t.elements,o=x(n,F).join(""),r=((e,t,n=0,o=e.length)=>{const r=t.regex;r.lastIndex=n;const s=[];let a;for(;a=r.exec(e);){const e=a[t.matchIndex],n=a.index+a[0].indexOf(e),l=n+e.length;if(l>o)break;s.push({start:n,finish:l}),r.lastIndex=l}return s})(o,e,t.sOffset,o.length-t.fOffset);return q(n,r)})),K=(e,t)=>{w(e,((e,n)=>{w(e,(e=>{const o=k.fromDom(t.cloneNode(!1));N(o,"data-mce-index",n);const r=e.element.dom;if(r.length===e.finish&&0===e.start)M(e.element,o);else{r.length!==e.finish&&r.splitText(e.finish);const t=r.splitText(e.start);M(k.fromDom(t),o)}}))}))},J=(e,t,n,o)=>{const r=n.getBookmark(),s=e.select("td[data-mce-selected],th[data-mce-selected]"),a=s.length>0?((e,t)=>v(t,(t=>U(e,t))))(e,s):L(e,n.getRng()),l=G(t,a);return K(l,o),n.moveToBookmark(r),l.length},Q=e=>e.getAttribute("data-mce-index"),X=(e,t,n,o)=>{const r=e.dom.create("span",{"data-mce-bogus":1});r.className="mce-match-marker";const s=e.getBody();return le(e,t,!1),o?J(e.dom,n,e.selection,r):((e,t,n,o)=>{const r=U(e,n),s=G(t,r);return K(s,o),s.length})(e.dom,n,s,r)},Y=e=>{var t;const n=e.parentNode;e.firstChild&&n.insertBefore(e.firstChild,e),null===(t=e.parentNode)||void 0===t||t.removeChild(e)},Z=(e,t)=>{const n=[],o=g.toArray(e.getBody().getElementsByTagName("span"));if(o.length)for(let r=0;r<o.length;r++){const e=Q(o[r]);null!==e&&e.length&&(e===t.toString()&&n.push(o[r]))}return n},ee=(e,t,n)=>{const o=t.get();let r=o.index;const s=e.dom;n?r+1===o.count?r=0:r++:r-1==-1?r=o.count-1:r--,s.removeClass(Z(e,o.index),"mce-match-marker-selected");const a=Z(e,r);return a.length?(s.addClass(Z(e,r),"mce-match-marker-selected"),e.selection.scrollIntoView(a[0]),r):-1},te=(e,t)=>{const n=t.parentNode;e.remove(t),n&&e.isEmpty(n)&&e.remove(n)},ne=(e,t,n,o,r,s)=>{const a=e.selection,l=((e,t)=>{const n="("+e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&").replace(/\s/g,"[^\\S\\r\\n\\uFEFF]")+")";return t?`(?:^|\\s|${u()})`+n+`(?=$|\\s|${u()})`:n})(n,r),i=a.isForward(),c={regex:new RegExp(l,o?"g":"gi"),matchIndex:1},d=X(e,t,c,s);if(h.browser.isSafari()&&a.setRng(a.getRng(),i),d){const a=ee(e,t,!0);t.set({index:a,count:d,text:n,matchCase:o,wholeWord:r,inSelection:s})}return d},oe=(e,t)=>{const n=ee(e,t,!0);t.set({...t.get(),index:n})},re=(e,t)=>{const n=ee(e,t,!1);t.set({...t.get(),index:n})},se=e=>{const t=Q(e);return null!==t&&t.length>0},ae=(e,t,n,o,r)=>{const s=t.get(),a=s.index;let l,i=a;o=!1!==o;const c=e.getBody(),d=g.grep(g.toArray(c.getElementsByTagName("span")),se);for(let m=0;m<d.length;m++){const t=Q(d[m]);let c=l=parseInt(t,10);if(r||c===s.index){for(n.length?(d[m].innerText=n,Y(d[m])):te(e.dom,d[m]);d[++m];){if(c=parseInt(Q(d[m]),10),c!==l){m--;break}te(e.dom,d[m])}o&&i--}else l>a&&d[m].setAttribute("data-mce-index",String(l-1))}return t.set({...s,count:r?0:s.count-1,index:i}),o?oe(e,t):re(e,t),!r&&t.get().count>0},le=(e,t,n)=>{let o,r;const s=t.get(),a=g.toArray(e.getBody().getElementsByTagName("span"));for(let l=0;l<a.length;l++){const e=Q(a[l]);null!==e&&e.length&&(e===s.index.toString()&&(o||(o=a[l].firstChild),r=a[l].firstChild),Y(a[l]))}if(t.set({...s,index:-1,count:0,text:""}),o&&r){const t=e.dom.createRng();return t.setStart(o,0),t.setEnd(r,r.data.length),!1!==n&&e.selection.setRng(t),t}},ie=()=>{const t=(t=>{const n=e(Optional.none()),o=()=>n.get().each(t);return{clear:()=>{o(),n.set(Optional.none())},isSet:()=>n.get().isSome(),get:()=>n.get(),set:e=>{o(),n.set(Optional.some(e))}}})(i);return{...t,on:e=>t.get().each(e)}},ce=(e,t)=>{const n=ie();e.undoManager.add();const o=g.trim(e.selection.getContent({format:"text"})),r=e=>{e.setEnabled("next",((e,t)=>t.get().count>1)(0,t)),e.setEnabled("prev",((e,t)=>t.get().count>1)(0,t))},s=(e,t)=>{y(["replace","replaceall","prev","next"],(n=>e.setEnabled(n,!t)))},a=(e,t)=>{h.browser.isSafari()&&h.deviceType.isTouch()&&("find"===t||"replace"===t||"replaceall"===t)&&e.focus(t)},l=n=>{le(e,t,!1),s(n,!0),r(n)},i=n=>{const o=n.getData(),a=t.get();if(o.findtext.length){if(a.text===o.findtext&&a.matchCase===o.matchcase&&a.wholeWord===o.wholewords)oe(e,t);else{const r=ne(e,t,o.findtext,o.matchcase,o.wholewords,o.inselection);r<=0&&(t=>{e.windowManager.alert("Could not find the specified string.",(()=>{t.focus("findtext")}))})(n),s(n,0===r)}r(n)}else l(n)},c=t.get(),d={title:"Find and Replace",size:"normal",body:{type:"panel",items:[{type:"bar",items:[{type:"input",name:"findtext",placeholder:"Find",maximized:!0,inputMode:"search"},{type:"button",name:"prev",text:"Previous",icon:"action-prev",enabled:!1,borderless:!0},{type:"button",name:"next",text:"Next",icon:"action-next",enabled:!1,borderless:!0}]},{type:"input",name:"replacetext",placeholder:"Replace with",inputMode:"search"}]},buttons:[{type:"menu",name:"options",icon:"preferences",tooltip:"Preferences",align:"start",items:[{type:"togglemenuitem",name:"matchcase",text:"Match case"},{type:"togglemenuitem",name:"wholewords",text:"Find whole words only"},{type:"togglemenuitem",name:"inselection",text:"Find in selection"}]},{type:"custom",name:"find",text:"Find",primary:!0},{type:"custom",name:"replace",text:"Replace",enabled:!1},{type:"custom",name:"replaceall",text:"Replace all",enabled:!1}],initialData:{findtext:o,replacetext:"",wholewords:c.wholeWord,matchcase:c.matchCase,inselection:c.inSelection},onChange:(e,n)=>{"findtext"===n.name&&t.get().count>0&&l(e)},onAction:(n,o)=>{const s=n.getData();switch(o.name){case"find":i(n);break;case"replace":ae(e,t,s.replacetext)?r(n):l(n);break;case"replaceall":ae(e,t,s.replacetext,!0,!0),l(n);break;case"prev":re(e,t),r(n);break;case"next":oe(e,t),r(n);break;case"matchcase":case"wholewords":case"inselection":(e=>{const n=e.getData(),o=t.get();t.set({...o,matchCase:n.matchcase,wholeWord:n.wholewords,inSelection:n.inselection})})(n),l(n)}a(n,o.name)},onSubmit:e=>{i(e),a(e,"find")},onClose:()=>{e.focus(),le(e,t),e.undoManager.add()}};n.set(e.windowManager.open(d,{inline:"toolbar"}))},de=(e,t)=>()=>{ce(e,t)};t.add("searchreplace",(t=>{const n=e({index:-1,count:0,text:"",matchCase:!1,wholeWord:!1,inSelection:!1});return((e,t)=>{e.addCommand("SearchReplace",(()=>{ce(e,t)}))})(t,n),((e,t)=>{e.ui.registry.addMenuItem("searchreplace",{text:"Find and replace...",shortcut:"Meta+F",onAction:de(e,t),icon:"search"}),e.ui.registry.addButton("searchreplace",{tooltip:"Find and replace",onAction:de(e,t),icon:"search"}),e.shortcuts.add("Meta+F","",de(e,t))})(t,n),((e,t)=>({done:n=>le(e,t,n),find:(n,o,r,s=!1)=>ne(e,t,n,o,r,s),next:()=>oe(e,t),prev:()=>re(e,t),replace:(n,o,r)=>ae(e,t,n,o,r)}))(t,n)}))}();