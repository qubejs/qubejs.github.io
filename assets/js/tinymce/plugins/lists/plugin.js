!function(){"use strict";var t=tinymce.util.Tools.resolve("tinymce.PluginManager");const e=t=>e=>(t=>{const e=typeof t;return null===t?"null":"object"===e&&Array.isArray(t)?"array":"object"===e&&(n=r=t,o=(s=String).prototype,o.isPrototypeOf(n)||(null===(i=r.constructor)||void 0===i?void 0:i.name)===s.name)?"string":e;var n,o;var r,s,i})(e)===t,n=t=>e=>typeof e===t,o=e("string"),r=e("object"),s=e("array"),i=n("boolean"),a=t=>!(t=>null==t)(t),l=n("function"),d=n("number"),c=()=>{},m=(t,e)=>t===e,u=t=>e=>!t(e),p=(g=!1,()=>g);var g;class Optional{constructor(t,e){this.tag=t,this.value=e}static some(t){return new Optional(!0,t)}static none(){return Optional.singletonNone}fold(t,e){return this.tag?e(this.value):t()}isSome(){return this.tag}isNone(){return!this.tag}map(t){return this.tag?Optional.some(t(this.value)):Optional.none()}bind(t){return this.tag?t(this.value):Optional.none()}exists(t){return this.tag&&t(this.value)}forall(t){return!this.tag||t(this.value)}filter(t){return!this.tag||t(this.value)?this:Optional.none()}getOr(t){return this.tag?this.value:t}or(t){return this.tag?this:t}getOrThunk(t){return this.tag?this.value:t()}orThunk(t){return this.tag?this:t()}getOrDie(t){if(this.tag)return this.value;throw new Error(null!=t?t:"Called getOrDie on None")}static from(t){return a(t)?Optional.some(t):Optional.none()}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(t){this.tag&&t(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}Optional.singletonNone=new Optional(!1);const f=Array.prototype.slice,h=Array.prototype.indexOf,y=Array.prototype.push,v=(t,e)=>{return n=t,o=e,h.call(n,o)>-1;var n,o},C=(t,e)=>{for(let n=0,o=t.length;n<o;n++){if(e(t[n],n))return!0}return!1},b=(t,e)=>{const n=t.length,o=new Array(n);for(let r=0;r<n;r++){const n=t[r];o[r]=e(n,r)}return o},O=(t,e)=>{for(let n=0,o=t.length;n<o;n++){e(t[n],n)}},S=(t,e)=>{const n=[];for(let o=0,r=t.length;o<r;o++){const r=t[o];e(r,o)&&n.push(r)}return n},N=(t,e,n)=>(O(t,((t,o)=>{n=e(n,t,o)})),n),L=(t,e,n)=>{for(let o=0,r=t.length;o<r;o++){const r=t[o];if(e(r,o))return Optional.some(r);if(n(r,o))break}return Optional.none()},T=(t,e)=>L(t,e,p),D=(t,e)=>(t=>{const e=[];for(let n=0,o=t.length;n<o;++n){if(!s(t[n]))throw new Error("Arr.flatten item "+n+" was not an array, input: "+t);y.apply(e,t[n])}return e})(b(t,e)),k=t=>{const e=f.call(t,0);return e.reverse(),e},A=(t,e)=>e>=0&&e<t.length?Optional.some(t[e]):Optional.none(),w=t=>A(t,0),E=t=>A(t,t.length-1),x=(t,e)=>{const n=[],o=l(e)?t=>C(n,(n=>e(n,t))):t=>v(n,t);for(let r=0,s=t.length;r<s;r++){const e=t[r];o(e)||n.push(e)}return n},B=(t,e,n=m)=>t.exists((t=>n(t,e))),P=(t,e,n)=>t.isSome()&&e.isSome()?Optional.some(n(t.getOrDie(),e.getOrDie())):Optional.none(),M=t=>{if(null==t)throw new Error("Node cannot be null or undefined");return{dom:t}},I={fromHtml:(t,e)=>{const n=(e||document).createElement("div");if(n.innerHTML=t,!n.hasChildNodes()||n.childNodes.length>1){const e="HTML does not have a single root node";throw console.error(e,t),new Error(e)}return M(n.childNodes[0])},fromTag:(t,e)=>{const n=(e||document).createElement(t);return M(n)},fromText:(t,e)=>{const n=(e||document).createTextNode(t);return M(n)},fromDom:M,fromPoint:(t,e,n)=>Optional.from(t.dom.elementFromPoint(e,n)).map(M)},R=(t,e)=>t.dom===e.dom,U=(t,e)=>{const n=t.dom;if(1!==n.nodeType)return!1;{const t=n;if(void 0!==t.matches)return t.matches(e);if(void 0!==t.msMatchesSelector)return t.msMatchesSelector(e);if(void 0!==t.webkitMatchesSelector)return t.webkitMatchesSelector(e);if(void 0!==t.mozMatchesSelector)return t.mozMatchesSelector(e);throw new Error("Browser lacks native selectors")}};"undefined"!=typeof window?window:Function("return this;")();const $=t=>t.dom.nodeName.toLowerCase(),_=(H=1,t=>(t=>t.dom.nodeType)(t)===H);var H;const F=t=>e=>_(e)&&$(e)===t,j=t=>Optional.from(t.dom.parentNode).map(I.fromDom),K=t=>b(t.dom.childNodes,I.fromDom),V=(t,e)=>{const n=t.dom.childNodes;return Optional.from(n[e]).map(I.fromDom)},z=t=>V(t,0),Q=t=>V(t,t.dom.childNodes.length-1),q=(t,e,n)=>{let o=t.dom;const r=l(n)?n:p;for(;o.parentNode;){o=o.parentNode;const t=I.fromDom(o);if(e(t))return Optional.some(t);if(r(t))break}return Optional.none()},W=(t,e,n)=>((t,e,n,o,r)=>t(n,o)?Optional.some(n):l(r)&&r(n)?Optional.none():e(n,o,r))(((t,e)=>e(t)),q,t,e,n),Z=(t,e)=>{j(t).each((n=>{n.dom.insertBefore(e.dom,t.dom)}))},G=(t,e)=>{const n=(t=>Optional.from(t.dom.nextSibling).map(I.fromDom))(t);n.fold((()=>{j(t).each((t=>{J(t,e)}))}),(t=>{Z(t,e)}))},J=(t,e)=>{t.dom.appendChild(e.dom)},X=(t,e)=>{O(e,(e=>{J(t,e)}))},Y=t=>{t.dom.textContent="",O(K(t),(t=>{tt(t)}))},tt=t=>{const e=t.dom;null!==e.parentNode&&e.parentNode.removeChild(e)};var et=tinymce.util.Tools.resolve("tinymce.dom.RangeUtils"),nt=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),ot=tinymce.util.Tools.resolve("tinymce.util.VK");const rt=t=>b(t,I.fromDom),st=Object.keys,it=(t,e)=>{const n=st(t);for(let o=0,r=n.length;o<r;o++){const r=n[o];e(t[r],r)}},at=(t,e)=>{const n={};var o;return((t,e,n,o)=>{it(t,((t,r)=>{(e(t,r)?n:o)(t,r)}))})(t,e,(o=n,(t,e)=>{o[e]=t}),c),n},lt=(t,e)=>{const n=t.dom;it(e,((t,e)=>{((t,e,n)=>{if(!(o(n)||i(n)||d(n)))throw console.error("Invalid call to Attribute.set. Key ",e,":: Value ",n,":: Element ",t),new Error("Attribute value was not simple");t.setAttribute(e,n+"")})(n,e,t)}))},dt=t=>N(t.dom.attributes,((t,e)=>(t[e.name]=e.value,t)),{}),ct=t=>((t,e)=>I.fromDom(t.dom.cloneNode(e)))(t,!0),mt=(t,e)=>{const n=((t,e)=>{const n=I.fromTag(e),o=dt(t);return lt(n,o),n})(t,e);G(t,n);const o=K(t);return X(n,o),tt(t),n};var ut=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),pt=tinymce.util.Tools.resolve("tinymce.util.Tools");const gt=t=>e=>a(e)&&e.nodeName.toLowerCase()===t,ft=t=>e=>a(e)&&t.test(e.nodeName),ht=t=>a(t)&&3===t.nodeType,yt=t=>a(t)&&1===t.nodeType,vt=ft(/^(OL|UL|DL)$/),Ct=ft(/^(OL|UL)$/),bt=gt("ol"),Ot=ft(/^(LI|DT|DD)$/),St=ft(/^(DT|DD)$/),Nt=ft(/^(TH|TD)$/),Lt=gt("br"),Tt=(t,e)=>a(e)&&e.nodeName in t.schema.getTextBlockElements(),Dt=(t,e)=>a(t)&&t.nodeName in e,kt=(t,e,n)=>{const o=t.isEmpty(e);return!(n&&t.select("span[data-mce-type=bookmark]",e).length>0)&&o},At=(t,e)=>t.isChildOf(e,t.getRoot()),wt=t=>e=>e.options.get(t),Et=wt("lists_indent_on_tab"),xt=wt("forced_root_block"),Bt=wt("forced_root_block_attrs"),Pt=(t,e)=>{const n=t.dom,o=t.schema.getBlockElements(),r=n.createFragment(),s=xt(t),i=Bt(t);let a,l,d=!1;for(l=n.create(s,i),Dt(e.firstChild,o)||r.appendChild(l);a=e.firstChild;){const t=a.nodeName;d||"SPAN"===t&&"bookmark"===a.getAttribute("data-mce-type")||(d=!0),Dt(a,o)?(r.appendChild(a),l=null):(l||(l=n.create(s,i),r.appendChild(l)),l.appendChild(a))}return!d&&l&&l.appendChild(n.create("br",{"data-mce-bogus":"1"})),r},Mt=ut.DOM,It=(t,e,n)=>{const o=Mt.select('span[data-mce-type="bookmark"]',e),r=Pt(t,n),s=Mt.createRng();s.setStartAfter(n),s.setEndAfter(e);const i=s.extractContents();for(let l=i.firstChild;l;l=l.firstChild)if("LI"===l.nodeName&&t.dom.isEmpty(l)){Mt.remove(l);break}t.dom.isEmpty(i)||Mt.insertAfter(i,e),Mt.insertAfter(r,e);const a=n.parentElement;a&&kt(t.dom,a)&&(t=>{const e=t.parentNode;e&&pt.each(o,(t=>{e.insertBefore(t,n.parentNode)})),Mt.remove(t)})(a),Mt.remove(n),kt(t.dom,e)&&Mt.remove(e)},Rt=F("dd"),Ut=F("dt"),$t=(t,e)=>{var n;Rt(e)?mt(e,"dt"):Ut(e)&&(n=e,Optional.from(n.dom.parentElement).map(I.fromDom)).each((n=>It(t,n.dom,e.dom)))},_t=t=>{Ut(t)&&mt(t,"dd")},Ht=(t,e)=>{if(ht(t))return{container:t,offset:e};const n=et.getNode(t,e);return ht(n)?{container:n,offset:e>=t.childNodes.length?n.data.length:0}:n.previousSibling&&ht(n.previousSibling)?{container:n.previousSibling,offset:n.previousSibling.data.length}:n.nextSibling&&ht(n.nextSibling)?{container:n.nextSibling,offset:0}:{container:t,offset:e}},Ft=t=>{const e=t.cloneRange(),n=Ht(t.startContainer,t.startOffset);e.setStart(n.container,n.offset);const o=Ht(t.endContainer,t.endOffset);return e.setEnd(o.container,o.offset),e},jt=["OL","UL","DL"],Kt=jt.join(","),Vt=(t,e)=>{const n=e||t.selection.getStart(!0);return t.dom.getParent(n,Kt,Wt(t,n))},zt=t=>{const e=Vt(t),n=t.selection.getSelectedBlocks();return((t,e)=>a(t)&&1===e.length&&e[0]===t)(e,n)?(t=>S(t.querySelectorAll(Kt),vt))(e):S(n,(t=>vt(t)&&e!==t))},Qt=t=>{const e=t.selection.getSelectedBlocks();return S(((t,e)=>{const n=pt.map(e,(e=>t.dom.getParent(e,"li,dd,dt",Wt(t,e))||e));return x(n)})(t,e),Ot)},qt=(t,e)=>{const n=t.dom.getParents(e,"TD,TH");return n.length>0?n[0]:t.getBody()},Wt=(t,e)=>{const n=t.dom.getParents(e,t.dom.isBlock),o=T(n,(e=>{return n=t.schema,!vt(o=e)&&!Ot(o)&&C(jt,(t=>n.isValidChild(o.nodeName,t)));var n,o}));return o.getOr(t.getBody())},Zt=(t,e)=>{const n=t.dom.getParents(e,"ol,ul",Wt(t,e));return E(n)},Gt=t=>{const e=(t=>{const e=Zt(t,t.selection.getStart()),n=S(t.selection.getSelectedBlocks(),Ct);return e.toArray().concat(n)})(t);return Jt(t,e)},Jt=(t,e)=>{const n=b(e,(e=>Zt(t,e).getOr(e)));return x(n)},Xt=t=>/\btox\-/.test(t.className),Yt=(t,e)=>L(t,vt,Nt).exists((t=>t.nodeName===e&&!Xt(t))),te=(t,e)=>null!==e&&"false"===t.dom.getContentEditableParent(e),ee=(t,e)=>{const n=t.dom.getParent(e,"ol,ul,dl");return te(t,n)},ne=(t,e)=>{const n=t.selection.getNode();return e({parents:t.dom.getParents(n),element:n}),t.on("NodeChange",e),()=>t.off("NodeChange",e)},oe=(t,e,n)=>t.dispatch("ListMutation",{action:e,element:n}),re=(se=/^\s+|\s+$/g,t=>t.replace(se,""));var se;const ie=(t,e,n)=>{if(!o(n))throw console.error("Invalid call to CSS.set. Property ",e,":: Value ",n,":: Element ",t),new Error("CSS value must be a string: "+n);(t=>void 0!==t.style&&l(t.style.getPropertyValue))(t)&&t.style.setProperty(e,n)},ae=(t,e,n)=>{const o=t.dom;ie(o,e,n)},le=(t,e)=>{J(t.item,e.list)},de=(t,e)=>{const n={list:I.fromTag(e,t),item:I.fromTag("li",t)};return J(n.list,n.item),n},ce=(t,e,n)=>{const o=e.slice(0,n.depth);return E(o).each((e=>{const o=((t,e,n)=>{const o=I.fromTag("li",t);return lt(o,e),X(o,n),o})(t,n.itemAttributes,n.content);((t,e)=>{J(t.list,e),t.item=e})(e,o),((t,e)=>{$(t.list)!==e.listType&&(t.list=mt(t.list,e.listType)),lt(t.list,e.listAttributes)})(e,n)})),o},me=(t,e,n)=>{const o=((t,e,n)=>{const o=[];for(let r=0;r<n;r++)o.push(de(t,e.listType));return o})(t,n,n.depth-e.length);var r;return(t=>{for(let e=1;e<t.length;e++)le(t[e-1],t[e])})(o),((t,e)=>{for(let n=0;n<t.length-1;n++)ae(t[n].item,"list-style-type","none");E(t).each((t=>{lt(t.list,e.listAttributes),lt(t.item,e.itemAttributes),X(t.item,e.content)}))})(o,n),r=o,P(E(e),w(r),le),e.concat(o)},ue=t=>U(t,"OL,UL"),pe=t=>z(t).exists(ue),ge=t=>t.depth>0,fe=t=>t.isSelected,he=t=>{const e=K(t),n=Q(t).exists(ue)?e.slice(0,-1):e;return b(n,ct)},ye=t=>(O(t,((e,n)=>{((t,e)=>{const n=t[e].depth,o=t=>t.depth===n&&!t.dirty,r=t=>t.depth<n;return L(k(t.slice(0,e)),o,r).orThunk((()=>L(t.slice(e+1),o,r)))})(t,n).fold((()=>{e.dirty&&(t=>{t.listAttributes=at(t.listAttributes,((t,e)=>"start"!==e))})(e)}),(t=>{return o=t,(n=e).listType=o.listType,void(n.listAttributes={...o.listAttributes});var n,o}))})),t),ve=(t,e,n,o)=>z(o).filter(ue).fold((()=>{e.each((t=>{R(t.start,o)&&n.set(!0)}));const r=((t,e,n)=>j(t).filter(_).map((o=>({depth:e,dirty:!1,isSelected:n,content:he(t),itemAttributes:dt(t),listAttributes:dt(o),listType:$(o)}))))(o,t,n.get());e.each((t=>{R(t.end,o)&&n.set(!1)}));const s=Q(o).filter(ue).map((o=>Ce(t,e,n,o))).getOr([]);return r.toArray().concat(s)}),(o=>Ce(t,e,n,o))),Ce=(t,e,n,o)=>D(K(o),(o=>(ue(o)?Ce:ve)(t+1,e,n,o))),be=(t,e)=>{const n=ye(e);return b(n,(e=>{const n=((t,e)=>{const n=(e||document).createDocumentFragment();return O(t,(t=>{n.appendChild(t.dom)})),I.fromDom(n)})(e.content);return I.fromDom(Pt(t,n.dom))}))},Oe=(t,e)=>{const n=ye(e);return((t,e)=>{const n=N(e,((e,n)=>n.depth>e.length?me(t,e,n):ce(t,e,n)),[]);return w(n).map((t=>t.list))})(t.contentDocument,n).toArray()},Se=(t,e,n)=>{const o=((t,e)=>{const n=(t=>{let e=!1;return{get:()=>e,set:t=>{e=t}}})();return b(t,(t=>({sourceList:t,entries:Ce(0,e,n,t)})))})(e,(t=>{const e=b(Qt(t),I.fromDom);return P(T(e,u(pe)),T(k(e),u(pe)),((t,e)=>({start:t,end:e})))})(t));O(o,(e=>{((t,e)=>{O(S(t,fe),(t=>((t,e)=>{switch(t){case"Indent":e.depth++;break;case"Outdent":e.depth--;break;case"Flatten":e.depth=0}e.dirty=!0})(e,t)))})(e.entries,n);const o=((t,e)=>D(((t,e)=>{if(0===t.length)return[];{let n=e(t[0]);const o=[];let r=[];for(let s=0,i=t.length;s<i;s++){const i=t[s],a=e(i);a!==n&&(o.push(r),r=[]),n=a,r.push(i)}return 0!==r.length&&o.push(r),o}})(e,ge),(e=>w(e).exists(ge)?Oe(t,e):be(t,e))))(t,e.entries);var r;O(o,(e=>{oe(t,"Indent"===n?"IndentList":"OutdentList",e.dom)})),r=e.sourceList,O(o,(t=>{Z(r,t)})),tt(e.sourceList)}))},Ne=(t,e)=>{const n=rt(Gt(t)),o=rt((t=>S(Qt(t),St))(t));let r=!1;if(n.length||o.length){const s=t.selection.getBookmark();Se(t,n,e),((t,e,n)=>{O(n,"Indent"===e?_t:e=>$t(t,e))})(t,e,o),t.selection.moveToBookmark(s),t.selection.setRng(Ft(t.selection.getRng())),t.nodeChanged(),r=!0}return r},Le=(t,e)=>!(t=>{const e=Vt(t);return te(t,e)})(t)&&Ne(t,e),Te=t=>Le(t,"Indent"),De=t=>Le(t,"Outdent"),ke=t=>Le(t,"Flatten");var Ae=tinymce.util.Tools.resolve("tinymce.dom.BookmarkManager");const we=ut.DOM,Ee=t=>{const e={},n=n=>{let o=t[n?"startContainer":"endContainer"],r=t[n?"startOffset":"endOffset"];if(yt(o)){const t=we.create("span",{"data-mce-type":"bookmark"});o.hasChildNodes()?(r=Math.min(r,o.childNodes.length-1),n?o.insertBefore(t,o.childNodes[r]):we.insertAfter(t,o.childNodes[r])):o.appendChild(t),o=t,r=0}e[n?"startContainer":"endContainer"]=o,e[n?"startOffset":"endOffset"]=r};return n(!0),t.collapsed||n(),e},xe=t=>{const e=e=>{let n=t[e?"startContainer":"endContainer"],o=t[e?"startOffset":"endOffset"];if(n){if(yt(n)&&n.parentNode){const t=n;o=(t=>{var e;let n=null===(e=t.parentNode)||void 0===e?void 0:e.firstChild,o=0;for(;n;){if(n===t)return o;yt(n)&&"bookmark"===n.getAttribute("data-mce-type")||o++,n=n.nextSibling}return-1})(n),n=n.parentNode,we.remove(t),!n.hasChildNodes()&&we.isBlock(n)&&n.appendChild(we.create("br"))}t[e?"startContainer":"endContainer"]=n,t[e?"startOffset":"endOffset"]=o}};e(!0),e();const n=we.createRng();return n.setStart(t.startContainer,t.startOffset),t.endContainer&&n.setEnd(t.endContainer,t.endOffset),Ft(n)},Be=t=>{switch(t){case"UL":return"ToggleUlList";case"OL":return"ToggleOlList";case"DL":return"ToggleDLList"}},Pe=(t,e)=>{pt.each(e,((e,n)=>{t.setAttribute(n,e)}))},Me=(t,e,n)=>{((t,e,n)=>{const o=n["list-style-type"]?n["list-style-type"]:null;t.setStyle(e,"list-style-type",o)})(t,e,n),((t,e,n)=>{Pe(e,n["list-attributes"]),pt.each(t.select("li",e),(t=>{Pe(t,n["list-item-attributes"])}))})(t,e,n)},Ie=(t,e,n,o)=>{let r=e[n?"startContainer":"endContainer"];const s=e[n?"startOffset":"endOffset"];for(yt(r)&&(r=r.childNodes[Math.min(s,r.childNodes.length-1)]||r),!n&&Lt(r.nextSibling)&&(r=r.nextSibling);r.parentNode!==o;){const e=r.parentNode;if(Tt(t,r))return r;if(/^(TD|TH)$/.test(e.nodeName))return r;r=e}return r},Re=(t,e,n)=>{const o=t.selection.getRng();let r="LI";const s=Wt(t,t.selection.getStart(!0)),i=t.dom;if("false"===i.getContentEditable(t.selection.getNode()))return;"DL"===(e=e.toUpperCase())&&(r="DT");const a=Ee(o),l=((t,e,n)=>{const o=[],r=t.dom,s=Ie(t,e,!0,n),i=Ie(t,e,!1,n);let a;const l=[];for(let d=s;d&&(l.push(d),d!==i);d=d.nextSibling);return pt.each(l,(e=>{var s;if(Tt(t,e))return o.push(e),void(a=null);if(r.isBlock(e)||Lt(e))return Lt(e)&&r.remove(e),void(a=null);const i=e.nextSibling;Ae.isBookmarkNode(e)&&(vt(i)||Tt(t,i)||!i&&e.parentNode===n)?a=null:(a||(a=r.create("p"),null===(s=e.parentNode)||void 0===s||s.insertBefore(a,e),o.push(a)),a.appendChild(e))})),o})(t,o,s);pt.each(l,(o=>{let s;const a=o.previousSibling,l=o.parentNode;Ot(l)||(a&&vt(a)&&a.nodeName===e&&((t,e,n)=>{const o=t.getStyle(e,"list-style-type");let r=n?n["list-style-type"]:"";return r=null===r?"":r,o===r})(i,a,n)?(s=a,o=i.rename(o,r),a.appendChild(o)):(s=i.create(e),l.insertBefore(s,o),s.appendChild(o),o=i.rename(o,r)),((t,e,n)=>{pt.each(n,(n=>t.setStyle(e,n,"")))})(i,o,["margin","margin-right","margin-bottom","margin-left","margin-top","padding","padding-right","padding-bottom","padding-left","padding-top"]),Me(i,s,n),$e(t.dom,s))})),t.selection.setRng(xe(a))},Ue=(t,e,n)=>{return((t,e)=>vt(t)&&t.nodeName===(null==e?void 0:e.nodeName))(e,n)&&((t,e,n)=>t.getStyle(e,"list-style-type",!0)===t.getStyle(n,"list-style-type",!0))(t,e,n)&&(o=n,e.className===o.className);var o},$e=(t,e)=>{let n,o=e.nextSibling;if(Ue(t,e,o)){const r=o;for(;n=r.firstChild;)e.appendChild(n);t.remove(r)}if(o=e.previousSibling,Ue(t,e,o)){const r=o;for(;n=r.lastChild;)e.insertBefore(n,e.firstChild);t.remove(r)}},_e=(t,e,n,o,r)=>{const s=vt(e);if(s&&e.nodeName===o&&!He(r))ke(t);else{Re(t,o,r);const i=Ee(t.selection.getRng()),a=s?[e,...n]:n;pt.each(a,(e=>{((t,e,n,o)=>{if(e.nodeName!==n){const r=t.dom.rename(e,n);Me(t.dom,r,o),oe(t,Be(n),r)}else Me(t.dom,e,o),oe(t,Be(n),e)})(t,e,o,r)})),t.selection.setRng(xe(i))}},He=t=>"list-style-type"in t,Fe=(t,e,n)=>{const o=Vt(t);if(ee(t,o))return;const s=zt(t),i=r(n)?n:{};s.length>0?_e(t,o,s,e,i):((t,e,n,o)=>{if(e!==t.getBody())if(e)if(e.nodeName!==n||He(o)||Xt(e)){const r=Ee(t.selection.getRng());Me(t.dom,e,o);const s=t.dom.rename(e,n);$e(t.dom,s),t.selection.setRng(xe(r)),Re(t,n,o),oe(t,Be(n),s)}else ke(t);else Re(t,n,o),oe(t,Be(n),e)})(t,o,e,i)},je=ut.DOM,Ke=(t,e)=>{const n=pt.grep(t.select("ol,ul",e));pt.each(n,(e=>{((t,e)=>{const n=e.parentElement;if(n&&"LI"===n.nodeName&&n.firstChild===e){const o=n.previousSibling;o&&"LI"===o.nodeName?(o.appendChild(e),kt(t,n)&&je.remove(n)):je.setStyle(n,"listStyleType","none")}if(vt(n)){const t=n.previousSibling;t&&"LI"===t.nodeName&&t.appendChild(e)}})(t,e)}))},Ve=(t,e,n,o)=>{let r=e.startContainer;const s=e.startOffset;if(ht(r)&&(n?s<r.data.length:s>0))return r;const i=t.schema.getNonEmptyElements();yt(r)&&(r=et.getNode(r,s));const a=new nt(r,o);n&&((t,e)=>!!Lt(e)&&t.isBlock(e.nextSibling)&&!Lt(e.previousSibling))(t.dom,r)&&a.next();const l=n?a.next.bind(a):a.prev2.bind(a);for(;r=l();){if("LI"===r.nodeName&&!r.hasChildNodes())return r;if(i[r.nodeName])return r;if(ht(r)&&r.data.length>0)return r}return null},ze=(t,e)=>{const n=e.childNodes;return 1===n.length&&!vt(n[0])&&t.isBlock(n[0])},Qe=(t,e,n)=>{let o;const r=ze(t,n)?n.firstChild:n;if(((t,e)=>{ze(t,e)&&t.remove(e.firstChild,!0)})(t,e),!kt(t,e,!0))for(;o=e.firstChild;)r.appendChild(o)},qe=(t,e,n)=>{let o;const r=e.parentNode;if(!At(t,e)||!At(t,n))return;vt(n.lastChild)&&(o=n.lastChild),r===n.lastChild&&Lt(r.previousSibling)&&t.remove(r.previousSibling);const s=n.lastChild;s&&Lt(s)&&e.hasChildNodes()&&t.remove(s),kt(t,n,!0)&&Y(I.fromDom(n)),Qe(t,e,n),o&&n.appendChild(o);const i=((t,e)=>{const n=t.dom,o=e.dom;return n!==o&&n.contains(o)})(I.fromDom(n),I.fromDom(e))?t.getParents(e,vt,n):[];t.remove(e),O(i,(e=>{kt(t,e)&&e!==t.getRoot()&&t.remove(e)}))},We=(t,e,n,o)=>{const r=t.dom;if(r.isEmpty(o))((t,e,n)=>{Y(I.fromDom(n)),qe(t.dom,e,n),t.selection.setCursorLocation(n,0)})(t,n,o);else{const s=Ee(e);qe(r,n,o),t.selection.setRng(xe(s))}},Ze=(t,e)=>{const n=t.dom,o=t.selection,r=o.getStart(),s=qt(t,r),i=n.getParent(o.getStart(),"LI",s);if(i){const r=i.parentElement;if(r===t.getBody()&&kt(n,r))return!0;const a=Ft(o.getRng()),l=n.getParent(Ve(t,a,e,s),"LI",s);if(l&&l!==i)return t.undoManager.transact((()=>{var n,o;e?We(t,a,l,i):(null===(o=(n=i).parentNode)||void 0===o?void 0:o.firstChild)===n?De(t):((t,e,n,o)=>{const r=Ee(e);qe(t.dom,n,o);const s=xe(r);t.selection.setRng(s)})(t,a,i,l)})),!0;if(!l&&!e&&0===a.startOffset&&0===a.endOffset)return t.undoManager.transact((()=>{ke(t)})),!0}return!1},Ge=(t,e)=>{const n=t.dom,o=t.selection.getStart(),r=qt(t,o),s=n.getParent(o,n.isBlock,r);if(s&&n.isEmpty(s)){const o=Ft(t.selection.getRng()),i=n.getParent(Ve(t,o,e,r),"LI",r);if(i){const a=t=>v(["td","th","caption"],$(t)),l=t=>t.dom===r;return!!((t,e,n=m)=>P(t,e,n).getOr(t.isNone()&&e.isNone()))(W(I.fromDom(i),a,l),W(I.fromDom(o.startContainer),a,l),R)&&(t.undoManager.transact((()=>{((t,e,n)=>{const o=t.getParent(e.parentNode,t.isBlock,n);t.remove(e),o&&t.isEmpty(o)&&t.remove(o)})(n,s,r),$e(n,i.parentNode),t.selection.select(i,!0),t.selection.collapse(e)})),!0)}}return!1},Je=t=>{const e=t.selection.getStart(),n=qt(t,e);return t.dom.getParent(e,"LI,DT,DD",n)||Qt(t).length>0},Xe=(t,e)=>{const n=t.selection;return!ee(t,n.getNode())&&(n.isCollapsed()?((t,e)=>Ze(t,e)||Ge(t,e))(t,e):(t=>!!Je(t)&&(t.undoManager.transact((()=>{t.execCommand("Delete"),Ke(t.dom,t.getBody())})),!0))(t))},Ye=t=>{const e=k(re(t).split("")),n=b(e,((t,e)=>{const n=t.toUpperCase().charCodeAt(0)-"A".charCodeAt(0)+1;return Math.pow(26,e)*n}));return N(n,((t,e)=>t+e),0)},tn=t=>{if(--t<0)return"";{const e=t%26,n=Math.floor(t/26);return tn(n)+String.fromCharCode("A".charCodeAt(0)+e)}},en=t=>{const e=parseInt(t.start,10);return B(t.listStyleType,"upper-alpha")?tn(e):B(t.listStyleType,"lower-alpha")?tn(e).toLowerCase():t.start},nn=t=>{const e=Vt(t);bt(e)&&!ee(t,e)&&t.windowManager.open({title:"List Properties",body:{type:"panel",items:[{type:"input",name:"start",label:"Start list at number",inputMode:"numeric"}]},initialData:{start:en({start:t.dom.getAttrib(e,"start","1"),listStyleType:Optional.from(t.dom.getStyle(e,"list-style-type"))})},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],onSubmit:e=>{(t=>{switch((t=>/^[0-9]+$/.test(t)?2:/^[A-Z]+$/.test(t)?0:(t=>/^[a-z]+$/.test(t))(t)?1:t.length>0?4:3)(t)){case 2:return Optional.some({listStyleType:Optional.none(),start:t});case 0:return Optional.some({listStyleType:Optional.some("upper-alpha"),start:Ye(t).toString()});case 1:return Optional.some({listStyleType:Optional.some("lower-alpha"),start:Ye(t).toString()});case 3:return Optional.some({listStyleType:Optional.none(),start:""});case 4:return Optional.none()}})(e.getData().start).each((e=>{t.execCommand("mceListUpdate",!1,{attrs:{start:"1"===e.start?"":e.start},styles:{"list-style-type":e.listStyleType.getOr("")}})})),e.close()}})},on=(t,e)=>()=>{const n=Vt(t);return a(n)&&n.nodeName===e},rn=t=>{t.addCommand("mceListProps",(()=>{nn(t)}))},sn=t=>{t.on("BeforeExecCommand",(e=>{const n=e.command.toLowerCase();"indent"===n?Te(t):"outdent"===n&&De(t)})),t.addCommand("InsertUnorderedList",((e,n)=>{Fe(t,"UL",n)})),t.addCommand("InsertOrderedList",((e,n)=>{Fe(t,"OL",n)})),t.addCommand("InsertDefinitionList",((e,n)=>{Fe(t,"DL",n)})),t.addCommand("RemoveList",(()=>{ke(t)})),rn(t),t.addCommand("mceListUpdate",((e,n)=>{r(n)&&((t,e)=>{const n=Vt(t);null===n||ee(t,n)||t.undoManager.transact((()=>{r(e.styles)&&t.dom.setStyles(n,e.styles),r(e.attrs)&&it(e.attrs,((e,o)=>t.dom.setAttrib(n,o,e)))}))})(t,n)})),t.addQueryStateHandler("InsertUnorderedList",on(t,"UL")),t.addQueryStateHandler("InsertOrderedList",on(t,"OL")),t.addQueryStateHandler("InsertDefinitionList",on(t,"DL"))},an=t=>{Et(t)&&(t=>{t.on("keydown",(e=>{e.keyCode!==ot.TAB||ot.metaKeyPressed(e)||t.undoManager.transact((()=>{(e.shiftKey?De(t):Te(t))&&e.preventDefault()}))}))})(t),(t=>{t.on("ExecCommand",(e=>{const n=e.command.toLowerCase();"delete"!==n&&"forwarddelete"!==n||!Je(t)||Ke(t.dom,t.getBody())})),t.on("keydown",(e=>{e.keyCode===ot.BACKSPACE?Xe(t,!1)&&e.preventDefault():e.keyCode===ot.DELETE&&Xe(t,!0)&&e.preventDefault()}))})(t)},ln=(t,e)=>n=>ne(t,(o=>{n.setActive(Yt(o.parents,e)),n.setEnabled(!ee(t,o.element))})),dn=(t,e)=>n=>ne(t,(o=>n.setEnabled(Yt(o.parents,e)&&!ee(t,o.element))));t.add("lists",(t=>((t=>{(0,t.options.register)("lists_indent_on_tab",{processor:"boolean",default:!0})})(t),t.hasPlugin("rtc",!0)?rn(t):(an(t),sn(t)),(t=>{const e=e=>()=>t.execCommand(e);t.hasPlugin("advlist")||(t.ui.registry.addToggleButton("numlist",{icon:"ordered-list",active:!1,tooltip:"Numbered list",onAction:e("InsertOrderedList"),onSetup:ln(t,"OL")}),t.ui.registry.addToggleButton("bullist",{icon:"unordered-list",active:!1,tooltip:"Bullet list",onAction:e("InsertUnorderedList"),onSetup:ln(t,"UL")}))})(t),(t=>{const e={text:"List properties...",icon:"ordered-list",onAction:()=>t.execCommand("mceListProps"),onSetup:dn(t,"OL")};t.ui.registry.addMenuItem("listprops",e),t.ui.registry.addContextMenu("lists",{update:e=>{const n=Vt(t,e);return bt(n)?["listprops"]:[]}})})(t),(t=>({backspaceDelete:e=>{Xe(t,e)}}))(t))))}();