!function(){"use strict";var t=tinymce.util.Tools.resolve("tinymce.PluginManager");const e=t=>e=>typeof e===t,o=(t=>e=>(t=>{const e=typeof t;return null===t?"null":"object"===e&&Array.isArray(t)?"array":"object"===e&&(o=r=t,n=(s=String).prototype,n.isPrototypeOf(o)||(null===(a=r.constructor)||void 0===a?void 0:a.name)===s.name)?"string":e;var o,n;var r,s,a})(e)===t)("string"),n=(r=null,t=>r===t);var r;const s=e("boolean"),a=e("number");class Optional{constructor(t,e){this.tag=t,this.value=e}static some(t){return new Optional(!0,t)}static none(){return Optional.singletonNone}fold(t,e){return this.tag?e(this.value):t()}isSome(){return this.tag}isNone(){return!this.tag}map(t){return this.tag?Optional.some(t(this.value)):Optional.none()}bind(t){return this.tag?t(this.value):Optional.none()}exists(t){return this.tag&&t(this.value)}forall(t){return!this.tag||t(this.value)}filter(t){return!this.tag||t(this.value)?this:Optional.none()}getOr(t){return this.tag?this.value:t}or(t){return this.tag?this:t}getOrThunk(t){return this.tag?this.value:t()}orThunk(t){return this.tag?this:t()}getOrDie(t){if(this.tag)return this.value;throw new Error(null!=t?t:"Called getOrDie on None")}static from(t){return(t=>null==t)(t)?Optional.none():Optional.some(t)}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(t){this.tag&&t(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}Optional.singletonNone=new Optional(!1);const i=(t,e)=>{for(let o=0,n=t.length;o<n;o++){e(t[o],o)}},l=Object.keys,c=(t,e)=>{const o=l(t);for(let n=0,r=o.length;n<r;n++){const r=o[n];e(t[r],r)}};"undefined"!=typeof window?window:Function("return this;")();const u=t=>t.dom.nodeValue,d=(t=>e=>(t=>t.dom.nodeType)(e)===t)(3),m=(t,e,n)=>{((t,e,n)=>{if(!(o(n)||s(n)||a(n)))throw console.error("Invalid call to Attribute.set. Key ",e,":: Value ",n,":: Element ",t),new Error("Attribute value was not simple");t.setAttribute(e,n+"")})(t.dom,e,n)},h=(t,e)=>{t.dom.removeAttribute(e)},g=(t,e)=>{const o=((t,e)=>{const o=t.dom.getAttribute(e);return null===o?void 0:o})(t,e);return void 0===o||""===o?[]:o.split(" ")},v=t=>void 0!==t.dom.classList,p=(t,e)=>((t,e,o)=>{const n=g(t,e).concat([o]);return m(t,e,n.join(" ")),!0})(t,"class",e),f=(t,e)=>((t,e,o)=>{const n=((t,e)=>{const o=[];for(let n=0,r=t.length;n<r;n++){const r=t[n];e(r,n)&&o.push(r)}return o})(g(t,e),(t=>t!==o));return n.length>0?m(t,e,n.join(" ")):h(t,e),!1})(t,"class",e),y=t=>{const e=v(t)?t.dom.classList:(t=>g(t,"class"))(t);0===e.length&&h(t,"class")},w=t=>{if(null==t)throw new Error("Node cannot be null or undefined");return{dom:t}},b={fromHtml:(t,e)=>{const o=(e||document).createElement("div");if(o.innerHTML=t,!o.hasChildNodes()||o.childNodes.length>1){const e="HTML does not have a single root node";throw console.error(e,t),new Error(e)}return w(o.childNodes[0])},fromTag:(t,e)=>{const o=(e||document).createElement(t);return w(o)},fromText:(t,e)=>{const o=(e||document).createTextNode(t);return w(o)},fromDom:w,fromPoint:(t,e,o)=>Optional.from(t.dom.elementFromPoint(e,o)).map(w)},O={"\xa0":"nbsp","\xad":"shy"},N=(t,e)=>{let o="";return c(t,((t,e)=>{o+=e})),new RegExp("["+o+"]",e?"g":"")},T=N(O),A=N(O,!0),k=(t=>{let e="";return c(t,(t=>{e&&(e+=","),e+="span.mce-"+t})),e})(O),C="mce-nbsp",E=t=>'<span data-mce-bogus="1" class="mce-'+O[t]+'">'+t+"</span>",L=t=>{const e=u(t);return d(t)&&o(e)&&T.test(e)},B=(t,e)=>{let o=[];const n=((t,e)=>{const o=t.length,n=new Array(o);for(let r=0;r<o;r++){const o=t[r];n[r]=e(o,r)}return n})(t.dom.childNodes,b.fromDom);return i(n,(t=>{e(t)&&(o=o.concat([t])),o=o.concat(B(t,e))})),o},D=t=>"span"===t.nodeName.toLowerCase()&&t.classList.contains("mce-nbsp-wrap"),S=(t,e)=>{const o=t.dom,n=B(b.fromDom(e),L);i(n,(e=>{var n;const r=e.dom.parentNode;if(D(r))s=b.fromDom(r),a=C,v(s)?s.dom.classList.add(a):p(s,a);else{const r=o.encode(null!==(n=u(e))&&void 0!==n?n:"").replace(A,E),s=o.create("div",{},r);let a;for(;a=s.lastChild;)o.insertAfter(a,e.dom);t.dom.remove(e.dom)}var s,a}))},V=(t,e)=>{const o=t.dom.select(k,e);i(o,(e=>{D(e)?((t,e)=>{v(t)?t.dom.classList.remove(e):f(t,e);y(t)})(b.fromDom(e),C):t.dom.remove(e,!0)}))},x=t=>{const e=t.getBody(),o=t.selection.getBookmark();let n=((t,e)=>{for(;t.parentNode;){if(t.parentNode===e)return e;t=t.parentNode}})(t.selection.getNode(),e);n=void 0!==n?n:e,V(t,n),S(t,n),t.selection.moveToBookmark(o)},j=(t,e)=>{((t,e)=>{t.dispatch("VisualChars",{state:e})})(t,e.get());const o=t.getBody();!0===e.get()?S(t,o):V(t,o)},M=(t,e)=>{t.addCommand("mceVisualChars",(()=>{((t,e)=>{e.set(!e.get());const o=t.selection.getBookmark();j(t,e),t.selection.moveToBookmark(o)})(t,e)}))},P=(_="visualchars_default_state",t=>t.options.get(_));var _;const H=(t,e)=>{const o=((t,e)=>{let o=null;return{cancel:()=>{n(o)||(clearTimeout(o),o=null)},throttle:(...r)=>{n(o)&&(o=setTimeout((()=>{o=null,t.apply(null,r)}),e))}}})((()=>{x(t)}),300);t.on("keydown",(n=>{!0===e.get()&&(13===n.keyCode?x(t):o.throttle())})),t.on("remove",o.cancel)},F=(t,e)=>o=>{o.setActive(e.get());const n=t=>o.setActive(t.state);return t.on("VisualChars",n),()=>t.off("VisualChars",n)};t.add("visualchars",(t=>{(t=>{(0,t.options.register)("visualchars_default_state",{processor:"boolean",default:!1})})(t);const e=(t=>{let e=t;return{get:()=>e,set:t=>{e=t}}})(P(t));return M(t,e),((t,e)=>{const o=()=>t.execCommand("mceVisualChars");t.ui.registry.addToggleButton("visualchars",{tooltip:"Show invisible characters",icon:"visualchars",onAction:o,onSetup:F(t,e)}),t.ui.registry.addToggleMenuItem("visualchars",{text:"Show invisible characters",icon:"visualchars",onAction:o,onSetup:F(t,e)})})(t,e),H(t,e),((t,e)=>{t.on("init",(()=>{j(t,e)}))})(t,e),(t=>({isEnabled:()=>t.get()}))(e)}))}();